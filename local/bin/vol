#!/bin/sh

#
# ~/local/bin/vol
#

PACTL="$(which pactl 2>/dev/null)"
if [ -z "$PACTL" ]
then
	printf "install a package that supplies the pactl utility\n"
	exit 127
fi

CURR="$($PACTL get-sink-volume @DEFAULT_SINK@ | awk '{print $5}' | tr -d '%')"
DISPVAL="0"
MUTE="$($PACTL get-sink-mute @DEFAULT_SINK@ |  awk '{print $2}')"
DOOB=1

vol_up() {
	if [ "$MUTE" = "no" ]
	then
		if [ "$CURR" -lt 96 ]
		then
			$PACTL set-sink-volume @DEFAULT_SINK@ +5%
		fi
	fi
}

vol_down() {
	if [ "$MUTE" = "no" ]
	then
		$PACTL set-sink-volume @DEFAULT_SINK@ -5%
	fi
}

vol_mute() {
	$PACTL set-sink-mute @DEFAULT_SINK@ toggle
	MUTE="$($PACTL get-sink-mute @DEFAULT_SINK@ |  awk '{print $2}')"
}

vol_mic() {
	$PACTL set-source-mute @DEFAULT_SOURCE@ toggle
}

case "$1" in
	"up" )
		vol_up
		;;
	"down" )
		vol_down
		;;
	"mute" )
		vol_mute
		;;
	"mic" )
		vol_mic
		;;
	* )
		DOOB=0
		;;
esac

if [ "$MUTE" = "no" ]
then
	DISPVAL="$($PACTL get-sink-volume @DEFAULT_SINK@ | awk '{print $5}' | tr -d '%')"
fi

if [ "$DOOB" -eq 1 ]
then
	do_ob "$DISPVAL"
else
	echo "$DISPVAL"
fi
